<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <title>–ú–∞–≥–∞–∑–∏–Ω –≤ Telegram</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      background-color: #f5f5f5;
      color: #333;
      margin: 0;
      padding: 0;
      min-height: 100vh;
      padding-bottom: 60px;
    }
    
    .header {
      display: flex;
      flex-direction: column;
      gap: 12px;
      padding: 12px 16px;
      background-color: #fff;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      position: sticky;
      top: 0;
      z-index: 100;
    }
    
    .header-title {
      display: flex;
      justify-content: space-between;
      align-items: center;
      width: 100%;
    }
    
    .search-container {
      width: 100%;
      position: relative;
    }
    
    .search-input {
      width: 100%;
      padding: 10px 16px 10px 40px;
      border-radius: 20px;
      border: 1px solid #e0e0e0;
      font-size: 14px;
    }
    
    .search-icon {
      position: absolute;
      left: 12px;
      top: 50%;
      transform: translateY(-50%);
      color: #888;
    }
    
    .categories {
      display: flex;
      gap: 8px;
      overflow-x: auto;
      padding: 8px 0;
      margin-bottom: -8px;
    }
    
    .category {
      padding: 6px 12px;
      background: #f0f0f0;
      border-radius: 15px;
      white-space: nowrap;
      font-size: 13px;
      cursor: pointer;
    }
    
    .category.active {
      background: #0096cf;
      color: white;
    }
    
    .page {
      display: none;
      padding: 0 16px 16px;
      max-width: 800px;
      margin: 0 auto;
      width: 100%;
    }
    
    .page.active {
      display: block;
    }
    
    .product-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: 16px;
      margin-top: 16px;
    }
    
    .product {
      background: #fff;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 2px 5px rgba(0,0,0,0.05);
      transition: transform 0.2s;
      display: flex;
      flex-direction: column;
      height: 100%;
    }
    
    .product:hover {
      transform: translateY(-3px);
    }
    
    .product-image {
      width: 100%;
      height: 150px;
      object-fit: cover;
      display: block;
    }
    
    .product-info {
      padding: 12px;
      display: flex;
      flex-direction: column;
      flex: 1;
    }
    
    .product-name {
      font-weight: 600;
      margin-bottom: 4px;
      font-size: 14px;
      height: 40px;
      overflow: hidden;
    }
    
    .product-price {
      color: #0096cf;
      font-weight: 700;
      font-size: 16px;
      margin-bottom: 8px;
    }
    
    .add-to-cart-btn {
      background-color: #0096cf;
      color: white;
      border: none;
      border-radius: 8px;
      padding: 6px 0;
      font-size: 13px;
      width: 100%;
      cursor: pointer;
      transition: background-color 0.2s;
    }
    
    .add-to-cart-btn:hover {
      background-color: #007db4;
    }
    
    .product-detail {
      background: #fff;
      border-radius: 12px;
      padding: 16px;
      margin-top: 16px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    }
    
    .product-detail-image {
      width: 100%;
      height: 250px;
      object-fit: cover;
      border-radius: 8px;
      display: block;
      margin-bottom: 16px;
    }
    
    .product-description {
      color: #666;
      line-height: 1.5;
      margin: 12px 0;
    }
    
    .btn {
      background-color: #0096cf;
      color: white;
      border: none;
      border-radius: 10px;
      padding: 12px 16px;
      font-size: 16px;
      font-weight: 600;
      width: 100%;
      cursor: pointer;
      transition: background-color 0.2s;
      margin-top: 16px;
    }
    
    .btn:hover {
      background-color: #007db4;
    }
    
    .btn-back {
      background-color: #f0f0f0;
      color: #333;
      margin-bottom: 16px;
    }
    
    .btn-back:hover {
      background-color: #e0e0e0;
    }
    
    .cart-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 0;
      border-bottom: 1px solid #eee;
    }
    
    .cart-item-info {
      flex: 1;
    }
    
    .cart-item-name {
      font-weight: 600;
      margin-bottom: 4px;
    }
    
    .cart-item-controls {
      display: flex;
      align-items: center;
      margin-top: 4px;
    }
    
    .cart-quantity-btn {
      width: 28px;
      height: 28px;
      border-radius: 50%;
      background: #f0f0f0;
      border: none;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      cursor: pointer;
    }
    
    .cart-quantity {
      margin: 0 8px;
      min-width: 24px;
      text-align: center;
    }
    
    .cart-total {
      background: #fff;
      border-radius: 12px;
      padding: 16px;
      margin-top: 16px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.05);
      font-weight: 700;
      font-size: 18px;
      display: flex;
      justify-content: space-between;
    }
    
    .cart-empty {
      text-align: center;
      padding: 40px 0;
      color: #888;
    }
    
    .cart-icon {
      position: relative;
      cursor: pointer;
    }
    
    .cart-count {
      position: absolute;
      top: -8px;
      right: -8px;
      background: #ff3b30;
      color: white;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      font-size: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .notification {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: #333;
      color: white;
      padding: 12px 24px;
      border-radius: 8px;
      z-index: 1000;
      opacity: 0;
      transition: opacity 0.3s;
    }
    
    .notification.show {
      opacity: 1;
    }
    
    .loading {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      display: none;
    }
    
    .loading-spinner {
      width: 40px;
      height: 40px;
      border: 4px solid rgba(255,255,255,0.3);
      border-radius: 50%;
      border-top-color: white;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    .order-form {
      background: #fff;
      border-radius: 12px;
      padding: 16px;
      margin-top: 16px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    }
    
    .form-group {
      margin-bottom: 16px;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 6px;
      font-weight: 500;
      font-size: 14px;
    }
    
    .form-group input {
      width: 100%;
      padding: 10px;
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      font-size: 14px;
    }
    
    .form-group.error input {
      border-color: #ff3b30;
    }
    
    .error-message {
      color: #ff3b30;
      font-size: 12px;
      margin-top: 4px;
      display: none;
    }
    
    .form-group.error .error-message {
      display: block;
    }
    
    .hidden {
      display: none;
    }
  </style>
</head>
<body>
  <div class="loading" id="loading">
    <div class="loading-spinner"></div>
  </div>
  
  <div class="notification" id="notification">–£—Å–ø–µ—à–Ω–æ!</div>
  
  <div class="header">
    <div class="header-title">
      <h1>–ú–∞–≥–∞–∑–∏–Ω</h1>
      <div class="cart-icon" id="cart-icon">
        üõí
        <span class="cart-count" id="cart-count">0</span>
      </div>
    </div>
    
    <div class="search-container">
      <span class="search-icon">üîç</span>
      <input type="text" id="search" placeholder="–ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–æ–≤..." class="search-input">
    </div>
    
    <div class="categories" id="categories">
      <!-- –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã —á–µ—Ä–µ–∑ JS -->
    </div>
  </div>

  <div id="catalog" class="page active">
    <h2>–ö–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤</h2>
    <div class="product-grid" id="product-grid">
      <!-- –¢–æ–≤–∞—Ä—ã –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã —á–µ—Ä–µ–∑ JS -->
    </div>
  </div>

  <div id="product-detail" class="page">
    <button class="btn btn-back" id="back-to-catalog">–ù–∞–∑–∞–¥ –∫ –∫–∞—Ç–∞–ª–æ–≥—É</button>
    <div class="product-detail" id="product-detail-content">
      <!-- –î–µ—Ç–∞–ª–∏ —Ç–æ–≤–∞—Ä–∞ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã —á–µ—Ä–µ–∑ JS -->
    </div>
  </div>

  <div id="cart" class="page">
    <button class="btn btn-back" id="back-to-catalog-from-cart">–ù–∞–∑–∞–¥ –∫ –∫–∞—Ç–∞–ª–æ–≥—É</button>
    <h2>–í–∞—à–∞ –∫–æ—Ä–∑–∏–Ω–∞</h2>
    <div id="cart-items">
      <!-- –≠–ª–µ–º–µ–Ω—Ç—ã –∫–æ—Ä–∑–∏–Ω—ã –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã —á–µ—Ä–µ–∑ JS -->
    </div>
    <div id="cart-total" class="cart-total hidden">
      –ò—Ç–æ–≥–æ: <span id="total-amount">0</span> —Ä—É–±.
    </div>
    
    <div class="order-form hidden" id="order-form">
      <h3>–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞</h3>
      
      <div class="form-group">
        <label for="name">–ò–º—è –∏ —Ñ–∞–º–∏–ª–∏—è</label>
        <input type="text" id="name" placeholder="–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤">
        <div class="error-message">–í–≤–µ–¥–∏—Ç–µ –∏–º—è –∏ —Ñ–∞–º–∏–ª–∏—é</div>
      </div>
      
      <div class="form-group">
        <label for="phone">–¢–µ–ª–µ—Ñ–æ–Ω</label>
        <input type="tel" id="phone" placeholder="+7 (999) 999-99-99">
        <div class="error-message">–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞</div>
      </div>
      
      <div class="form-group">
        <label for="address">–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏</label>
        <input type="text" id="address" placeholder="–£–ª–∏—Ü–∞, –¥–æ–º, –∫–≤–∞—Ä—Ç–∏—Ä–∞">
        <div class="error-message">–í–≤–µ–¥–∏—Ç–µ –∞–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏</div>
      </div>
      
      <button class="btn" id="submit-order">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∑–∞–∫–∞–∑</button>
    </div>
    
    <button class="btn" id="checkout">–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑</button>
  </div>

  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script>
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp
    Telegram.WebApp.expand();
    Telegram.WebApp.setHeaderColor('#ffffff');
    Telegram.WebApp.setBackgroundColor('#f5f5f5');
    
    // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ—Å–Ω–æ–≤–Ω–æ–π –∫–Ω–æ–ø–∫–∏
    Telegram.WebApp.MainButton.setText("–ü–µ—Ä–µ–π—Ç–∏ –≤ –∫–æ—Ä–∑–∏–Ω—É").hide();
    
    // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è API
    const API_CONFIG = {
      BASE_URL: '/api',  // Vercel –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∏—Ä—É–µ—Ç /api –∫ –ø–∞–ø–∫–µ api
      TIMEOUT: 10000
    };
    
    // –ö–ª–∞—Å—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å API
    class ApiClient {
      static async request(endpoint, method = 'GET', data = null) {
        try {
          const headers = {
            'Content-Type': 'application/json',
            'X-Telegram-Init-Data': Telegram.WebApp.initData
          };
          
          const options = {
            method,
            headers,
            signal: AbortSignal.timeout(API_CONFIG.TIMEOUT)
          };
          
          if (data) {
            options.body = JSON.stringify(data);
          }
          
          const response = await fetch(`${API_CONFIG.BASE_URL}${endpoint}`, options);
          
          if (!response.ok) {
            const errorData = await response.json().catch(() => null);
            const errorMessage = errorData?.message || `–û—à–∏–±–∫–∞ ${response.status}`;
            throw new Error(errorMessage);
          }
          
          return response.json();
        } catch (error) {
          // –õ–æ–≥–∏—Ä—É–µ–º –æ—à–∏–±–∫—É –Ω–∞ —Å–µ—Ä–≤–µ—Ä
          this.logError(endpoint, method, error.message);
          throw error;
        }
      }
      
      static async logError(endpoint, method, errorMessage) {
        try {
          await fetch(`${API_CONFIG.BASE_URL}/logs`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'X-Telegram-Init-Data': Telegram.WebApp.initData
            },
            body: JSON.stringify({
              endpoint,
              method,
              error: errorMessage,
              timestamp: new Date().toISOString(),
              user: Telegram.WebApp.initDataUnsafe?.user?.id
            })
          });
        } catch (logError) {
          console.error('Failed to log error:', logError);
        }
      }
      
      static async createOrder(orderData) {
        return this.request('/orders', 'POST', orderData);
      }
    }
    
    // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏
    function showNotification(message, type = 'success') {
      const notification = document.getElementById('notification');
      notification.textContent = message;
      notification.className = 'notification show';
      
      setTimeout(() => {
        notification.classList.remove('show');
      }, 3000);
      
      // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–±—ã—Ç–∏–µ –≤ Telegram –¥–ª—è —Ç–∞–∫—Ç–∏–ª—å–Ω–æ–π –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏
      if (type === 'success') {
        Telegram.WebApp.HapticFeedback.notificationOccurred('success');
      } else if (type === 'error') {
        Telegram.WebApp.HapticFeedback.notificationOccurred('error');
      }
    }
    
    // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–æ–π
    function setLoading(loading) {
      document.getElementById('loading').style.display = loading ? 'flex' : 'none';
    }
    
    // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º–∏
    function showPage(pageId) {
      document.querySelectorAll('.page').forEach(page => {
        page.classList.remove('active');
      });
      document.getElementById(pageId).classList.add('active');
      
      // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—ã
      if (pageId === 'catalog') {
        document.querySelector('.header h1').textContent = '–ú–∞–≥–∞–∑–∏–Ω';
      } else if (pageId === 'product-detail') {
        document.querySelector('.header h1').textContent = '–¢–æ–≤–∞—Ä';
      } else if (pageId === 'cart') {
        document.querySelector('.header h1').textContent = '–ö–æ—Ä–∑–∏–Ω–∞';
      }
    }
    
    // –†–∞–±–æ—Ç–∞ —Å –∫–æ—Ä–∑–∏–Ω–æ–π
    function getCart() {
      const cart = localStorage.getItem('cart');
      return cart ? JSON.parse(cart) : [];
    }
    
    function saveCart(cart) {
      localStorage.setItem('cart', JSON.stringify(cart));
      updateCartCount();
      updateMainButton();
    }
    
    function addToCart(productId, quantity = 1) {
      const cart = getCart();
      const existingItem = cart.find(item => item.id === productId);
      
      if (existingItem) {
        existingItem.quantity += quantity;
      } else {
        cart.push({ id: productId, quantity });
      }
      
      saveCart(cart);
      Telegram.WebApp.HapticFeedback.impactOccurred('light');
      showNotification('–¢–æ–≤–∞—Ä –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∫–æ—Ä–∑–∏–Ω—É!');
    }
    
    function updateQuantity(productId, quantity) {
      if (quantity <= 0) return;
      
      const cart = getCart();
      const item = cart.find(item => item.id === productId);
      
      if (item) {
        item.quantity = quantity;
        saveCart(cart);
      }
      
      renderCart();
    }
    
    function removeFromCart(productId) {
      let cart = getCart();
      cart = cart.filter(item => item.id !== productId);
      saveCart(cart);
      renderCart();
    }
    
    function clearCart() {
      localStorage.removeItem('cart');
      updateCartCount();
      updateMainButton();
      renderCart();
    }
    
    function updateCartCount() {
      const count = getCart().reduce((sum, item) => sum + item.quantity, 0);
      document.getElementById('cart-count').textContent = count;
      document.getElementById('cart-count').classList.toggle('hidden', count === 0);
    }
    
    function updateMainButton() {
      const cart = getCart();
      if (cart.length > 0) {
        Telegram.WebApp.MainButton.show();
      } else {
        Telegram.WebApp.MainButton.hide();
      }
    }
    
    // –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
    function validateForm() {
      const name = document.getElementById('name').value.trim();
      const phone = document.getElementById('phone').value.trim();
      const address = document.getElementById('address').value.trim();
      
      let isValid = true;
      
      // –°–±—Ä–æ—Å –æ—à–∏–±–æ–∫
      document.querySelectorAll('.form-group').forEach(group => {
        group.classList.remove('error');
      });
      
      // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–º–µ–Ω–∏
      if (!name || name.split(' ').length < 2) {
        document.getElementById('name').closest('.form-group').classList.add('error');
        isValid = false;
      }
      
      // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
      const phoneRegex = /^(\+7|7|8)[\s\-]?\(?[489][0-9]{2}\)?[\s\-]?[0-9]{3}[\s\-]?[0-9]{2}[\s\-]?[0-9]{2}$/;
      if (!phone || !phoneRegex.test(phone)) {
        document.getElementById('phone').closest('.form-group').classList.add('error');
        isValid = false;
      }
      
      // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–¥—Ä–µ—Å–∞
      if (!address || address.length < 10) {
        document.getElementById('address').closest('.form-group').classList.add('error');
        isValid = false;
      }
      
      return isValid;
    }
    
    // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
    function renderCategories() {
      const categoriesElement = document.getElementById('categories');
      categoriesElement.innerHTML = '';
      
      CATEGORIES.forEach(category => {
        const categoryElement = document.createElement('div');
        categoryElement.className = `category ${category.id === currentCategory ? 'active' : ''}`;
        categoryElement.textContent = category.name;
        categoryElement.dataset.categoryId = category.id;
        
        categoryElement.addEventListener('click', () => {
          currentCategory = category.id;
          document.querySelectorAll('.category').forEach(cat => {
            cat.classList.remove('active');
          });
          categoryElement.classList.add('active');
          renderCatalog();
        });
        
        categoriesElement.appendChild(categoryElement);
      });
    }
    
    function renderCatalog() {
      const productGrid = document.getElementById('product-grid');
      productGrid.innerHTML = '';
      
      // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∏ –ø–æ–∏—Å–∫
      let filteredProducts = products;
      
      if (currentCategory !== 'all') {
        filteredProducts = filteredProducts.filter(p => p.category === currentCategory);
      }
      
      const searchTerm = document.getElementById('search').value.toLowerCase().trim();
      if (searchTerm) {
        filteredProducts = filteredProducts.filter(p => 
          p.name.toLowerCase().includes(searchTerm) || 
          p.description.toLowerCase().includes(searchTerm)
        );
      }
      
      if (filteredProducts.length === 0) {
        productGrid.innerHTML = `
          <div class="cart-empty" style="width: 100%; grid-column: 1 / -1;">
            <p>–¢–æ–≤–∞—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>
            <p>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –∑–∞–ø—Ä–æ—Å –∏–ª–∏ –≤—ã–±—Ä–∞—Ç—å –¥—Ä—É–≥—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é</p>
          </div>
        `;
        return;
      }
      
      filteredProducts.forEach(product => {
        const productElement = document.createElement('div');
        productElement.className = 'product';
        productElement.innerHTML = `
          <img src="${product.image}" alt="${product.name}" class="product-image">
          <div class="product-info">
            <div class="product-name">${product.name}</div>
            <div class="product-price">${product.price} —Ä—É–±.</div>
            <button class="add-to-cart-btn" data-id="${product.id}">–î–æ–±–∞–≤–∏—Ç—å</button>
          </div>
        `;
        
        productElement.querySelector('.add-to-cart-btn').addEventListener('click', (e) => {
          e.stopPropagation();
          addToCart(product.id);
        });
        
        productElement.addEventListener('click', () => {
          showPage('product-detail');
          renderProductDetail(product);
        });
        
        productGrid.appendChild(productElement);
      });
    }
    
    function renderProductDetail(product) {
      const productDetailContent = document.getElementById('product-detail-content');
      productDetailContent.innerHTML = `
        <img src="${product.image}" alt="${product.name}" class="product-detail-image">
        <h2>${product.name}</h2>
        <div class="product-price" style="font-size: 20px; margin: 10px 0;">${product.price} —Ä—É–±.</div>
        <div class="product-description">${product.description}</div>
        <div style="display: flex; gap: 8px; margin-top: 16px;">
          <button class="btn" id="add-to-cart-btn" style="flex: 1;">–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É</button>
          <button class="btn" id="add-quantity-btn" style="width: 40px; padding: 0;">+</button>
        </div>
      `;
      
      document.getElementById('add-to-cart-btn').addEventListener('click', () => {
        addToCart(product.id);
      });
      
      document.getElementById('add-quantity-btn').addEventListener('click', () => {
        addToCart(product.id, 1);
      });
    }
    
    function renderCart() {
      const cartItemsElement = document.getElementById('cart-items');
      const cartTotalElement = document.getElementById('cart-total');
      const checkoutButton = document.getElementById('checkout');
      const orderForm = document.getElementById('order-form');
      const totalAmountElement = document.getElementById('total-amount');
      
      const cart = getCart();
      
      if (cart.length === 0) {
        cartItemsElement.innerHTML = `
          <div class="cart-empty">
            <p>–í–∞—à–∞ –∫–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</p>
            <p>–î–æ–±–∞–≤—å—Ç–µ —Ç–æ–≤–∞—Ä—ã –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞</p>
          </div>
        `;
        cartTotalElement.classList.add('hidden');
        checkoutButton.style.display = 'none';
        orderForm.classList.add('hidden');
        return;
      }
      
      let total = 0;
      let cartHTML = '';
      
      cart.forEach(cartItem => {
        const product = products.find(p => p.id === cartItem.id);
        if (product) {
          const itemTotal = product.price * cartItem.quantity;
          total += itemTotal;
          
          cartHTML += `
            <div class="cart-item">
              <div class="cart-item-info">
                <div class="cart-item-name">${product.name}</div>
                <div class="product-price">${product.price} —Ä—É–±.</div>
                <div class="cart-item-controls">
                  <button class="cart-quantity-btn minus" data-id="${product.id}">-</button>
                  <span class="cart-quantity">${cartItem.quantity}</span>
                  <button class="cart-quantity-btn plus" data-id="${product.id}">+</button>
                </div>
              </div>
              <div>
                <button class="cart-quantity-btn" style="background: #ff3b30; color: white;" data-remove="${product.id}">√ó</button>
              </div>
            </div>
          `;
        }
      });
      
      cartItemsElement.innerHTML = cartHTML;
      totalAmountElement.textContent = total;
      cartTotalElement.classList.remove('hidden');
      checkoutButton.style.display = 'block';
      orderForm.classList.add('hidden');
      
      // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –¥–ª—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –∫–æ—Ä–∑–∏–Ω—ã
      document.querySelectorAll('.cart-quantity-btn.minus').forEach(button => {
        button.addEventListener('click', (e) => {
          const productId = parseInt(e.target.getAttribute('data-id'));
          const cart = getCart();
          const item = cart.find(i => i.id === productId);
          if (item && item.quantity > 1) {
            updateQuantity(productId, item.quantity - 1);
          }
        });
      });
      
      document.querySelectorAll('.cart-quantity-btn.plus').forEach(button => {
        button.addEventListener('click', (e) => {
          const productId = parseInt(e.target.getAttribute('data-id'));
          updateQuantity(productId, getCart().find(i => i.id === productId).quantity + 1);
        });
      });
      
      document.querySelectorAll('[data-remove]').forEach(button => {
        button.addEventListener('click', (e) => {
          const productId = parseInt(e.target.getAttribute('data-remove'));
          removeFromCart(productId);
        });
      });
    }
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    async function initApp() {
      try {
        setLoading(true);
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ Telegram
        if (!Telegram.WebApp.initData) {
          throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏');
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        const userData = Telegram.WebApp.initDataUnsafe?.user;
        if (!userData) {
          throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è');
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Å —Å–µ—Ä–≤–µ—Ä–∞ (–≤ —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏)
        // const serverProducts = await ApiClient.request('/products');
        // products = serverProducts;
        
        updateCartCount();
        renderCategories();
        renderCatalog();
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
        document.getElementById('back-to-catalog').addEventListener('click', () => {
          showPage('catalog');
        });
        
        document.getElementById('back-to-catalog-from-cart').addEventListener('click', () => {
          showPage('catalog');
        });
        
        document.getElementById('cart-icon').addEventListener('click', () => {
          showPage('cart');
          renderCart();
        });
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—Å–Ω–æ–≤–Ω–æ–π –∫–Ω–æ–ø–∫–∏ Telegram
        Telegram.WebApp.MainButton.onClick(() => {
          showPage('cart');
          renderCart();
        });
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø–æ–∏—Å–∫–∞
        document.getElementById('search').addEventListener('input', () => {
          renderCatalog();
        });
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞
        document.getElementById('checkout').addEventListener('click', () => {
          document.getElementById('order-form').classList.remove('hidden');
          checkoutButton.style.display = 'none';
        });
        
        document.getElementById('submit-order').addEventListener('click', async () => {
          if (!validateForm()) {
            showNotification('–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è —Ñ–æ—Ä–º—ã', 'error');
            return;
          }
          
          try {
            setLoading(true);
            
            const cart = getCart();
            const orderData = {
              items: cart.map(item => ({
                id: item.id,
                quantity: item.quantity,
                product: products.find(p => p.id === item.id)
              })),
              total: cart.reduce((sum, item) => {
                const product = products.find(p => p.id === item.id);
                return sum + (product ? product.price * item.quantity : 0);
              }, 0),
              user: {
                id: Telegram.WebApp.initDataUnsafe.user.id,
                first_name: Telegram.WebApp.initDataUnsafe.user.first_name,
                last_name: Telegram.WebApp.initDataUnsafe.user.last_name,
                username: Telegram.WebApp.initDataUnsafe.user.username
              },
              delivery: {
                name: document.getElementById('name').value,
                phone: document.getElementById('phone').value,
                address: document.getElementById('address').value
              }
            };
            
            // –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–∫–∞–∑–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
            await ApiClient.createOrder(orderData);
            
            // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ–≥–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
            showNotification(`–ó–∞–∫–∞–∑ –æ—Ñ–æ—Ä–º–ª–µ–Ω! –°—É–º–º–∞: ${orderData.total} —Ä—É–±.`);
            
            // –û—á–∏—Å—Ç–∫–∞ –∫–æ—Ä–∑–∏–Ω—ã
            clearCart();
            
            // –í–æ–∑–≤—Ä–∞—Ç –∫ –∫–∞—Ç–∞–ª–æ–≥—É
            setTimeout(() => {
              showPage('catalog');
            }, 1500);
            
          } catch (error) {
            console.error('Order error:', error);
            showNotification(`–û—à–∏–±–∫–∞ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞: ${error.message}`, 'error');
          } finally {
            setLoading(false);
          }
        });
        
      } catch (error) {
        console.error('Initialization error:', error);
        showNotification(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è: ${error.message}`, 'error');
      } finally {
        setLoading(false);
      }
    }
    
    // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
    const CATEGORIES = [
      { id: 'all', name: '–í—Å–µ' },
      { id: 'electronics', name: '–≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞' },
      { id: 'audio', name: '–ê—É–¥–∏–æ' },
      { id: 'smart_home', name: '–£–º–Ω—ã–π –¥–æ–º' },
      { id: 'gadgets', name: '–ì–∞–¥–∂–µ—Ç—ã' }
    ];
    
    let currentCategory = 'all';
    
    // –ü—Ä–∏–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ —Å –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏
    const products = [
      { 
        id: 1, 
        name: "–°–º–∞—Ä—Ç—Ñ–æ–Ω X1", 
        price: 25990, 
        image: "https://via.placeholder.com/300/92c952",
        description: "–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —Å–º–∞—Ä—Ç—Ñ–æ–Ω —Å –º–æ—â–Ω—ã–º –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–æ–º –∏ –æ—Ç–ª–∏—á–Ω–æ–π –∫–∞–º–µ—Ä–æ–π. –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –∏–≥—Ä –∏ –ø–æ–≤—Å–µ–¥–Ω–µ–≤–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è.",
        category: 'electronics'
      },
      { 
        id: 2, 
        name: "–ù–∞—É—à–Ω–∏–∫–∏ Pro", 
        price: 5990, 
        image: "https://via.placeholder.com/300/771796",
        description: "–ë–µ—Å–ø—Ä–æ–≤–æ–¥–Ω—ã–µ –Ω–∞—É—à–Ω–∏–∫–∏ —Å —à—É–º–æ–ø–æ–¥–∞–≤–ª–µ–Ω–∏–µ–º –∏ –¥–ª–∏—Ç–µ–ª—å–Ω—ã–º –≤—Ä–µ–º–µ–Ω–µ–º —Ä–∞–±–æ—Ç—ã –æ—Ç –∞–∫–∫—É–º—É–ª—è—Ç–æ—Ä–∞.",
        category: 'audio'
      },
      { 
        id: 3, 
        name: "–°–º–∞—Ä—Ç-—á–∞—Å—ã", 
        price: 12990, 
        image: "https://via.placeholder.com/300/24f355",
        description: "–£–º–Ω—ã–µ —á–∞—Å—ã —Å —Ñ—É–Ω–∫—Ü–∏–µ–π –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∑–¥–æ—Ä–æ–≤—å—è, –ø–æ–≥–æ–¥—ã –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏ —Å–æ —Å–º–∞—Ä—Ç—Ñ–æ–Ω–∞.",
        category: 'electronics'
      },
      { 
        id: 4, 
        name: "–ü–ª–∞–Ω—à–µ—Ç Light", 
        price: 18990, 
        image: "https://via.placeholder.com/300/d32776",
        description: "–õ–µ–≥–∫–∏–π –∏ –∫–æ–º–ø–∞–∫—Ç–Ω—ã–π –ø–ª–∞–Ω—à–µ—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã –∏ —Ä–∞–∑–≤–ª–µ—á–µ–Ω–∏–π —Å –≤—ã—Å–æ–∫–æ–∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–º –¥–∏—Å–ø–ª–µ–µ–º.",
        category: 'electronics'
      },
      { 
        id: 5, 
        name: "–ü–æ—Ä—Ç–∞—Ç–∏–≤–Ω–∞—è –∫–æ–ª–æ–Ω–∫–∞", 
        price: 3490, 
        image: "https://via.placeholder.com/300/f66b97",
        description: "–ö–æ–º–ø–∞–∫—Ç–Ω–∞—è –∫–æ–ª–æ–Ω–∫–∞ —Å –æ—Ç–ª–∏—á–Ω—ã–º –∑–≤—É–∫–æ–º –∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –ø–æ Bluetooth.",
        category: 'audio'
      },
      { 
        id: 6, 
        name: "–£–º–Ω–∞—è –ª–∞–º–ø–∞", 
        price: 2790, 
        image: "https://via.placeholder.com/300/56a8c2",
        description: "–°–≤–µ—Ç–∏–ª—å–Ω–∏–∫ —Å —Ä–µ–≥—É–ª–∏—Ä—É–µ–º–æ–π —è—Ä–∫–æ—Å—Ç—å—é –∏ —Ü–≤–µ—Ç–æ–≤–æ–π —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–æ–π, —É–ø—Ä–∞–≤–ª—è–µ–º—ã–π —á–µ—Ä–µ–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ.",
        category: 'smart_home'
      },
      { 
        id: 7, 
        name: "–ü–∞—É—ç—Ä–±–∞–Ω–∫ Pro", 
        price: 1990, 
        image: "https://via.placeholder.com/300/e92777",
        description: "–ö–æ–º–ø–∞–∫—Ç–Ω—ã–π –ø–∞—É—ç—Ä–±–∞–Ω–∫ —Å –±—ã—Å—Ç—Ä–æ–π –∑–∞—Ä—è–¥–∫–æ–π –∏ USB-C –ø–æ—Ä—Ç–æ–º.",
        category: 'gadgets'
      },
      { 
        id: 8, 
        name: "–£–º–Ω—ã–µ –≤–µ—Å—ã", 
        price: 4590, 
        image: "https://via.placeholder.com/300/3724ff",
        description: "–í–µ—Å—ã —Å –∞–Ω–∞–ª–∏–∑–æ–º —Å–æ—Å—Ç–∞–≤–∞ —Ç–µ–ª–∞ –∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–µ–π —Å–æ —Å–º–∞—Ä—Ç—Ñ–æ–Ω–æ–º.",
        category: 'smart_home'
      }
    ];
    
    // –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–æ—Å–ª–µ –ø–æ–ª–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏
    document.addEventListener('DOMContentLoaded', initApp);
  </script>
</body>
</html>